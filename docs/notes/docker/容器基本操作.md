
## 1.容器基本操作

1.查看容器

```
docker ps
```

查看当前docker引擎中**正在运行的容器**

```
root@hp-None:~# docker ps
CONTAINER ID   IMAGE        COMMAND             CREATED          STATUS          PORTS      NAMES
65581914eb04   tomcat:8.0   "catalina.sh run"   2 minutes ago    Up 2 minutes    8080/tcp  infallible_lewin 
```

说明：

CONTAINER ID：**容器ID**

IMAGE：基于指定镜像

COMMAND：容器内启动服务命令

CREATED：容器创建时间

STATUS：容器状态

PORTS：**容器服务监听的端口**

NAMES：**容器名称**

2.运行容器

```
docker run 镜像名|镜像ID
```

a.简单运行

```
root@hp-None:~# docker pull tomcat:8.0
8.0: Pulling from library/tomcat
f189db1b88b3: Pull complete 
3d06cf2f1b5e: Pull complete 
edd0da9e3091: Pull complete 
eb7768aae14e: Pull complete 
e2780f585e0f: Pull complete 
e5ed720afeba: Pull complete 
d9e134700cfc: Pull complete 
e4804b33d02a: Pull complete 
b9df0c24315e: Pull complete 
49fdae8eaa20: Pull complete 
1aea3d9a32e6: Pull complete 
Digest: sha256:8ecb10948deb32c34aeadf7bf95d12a93fbd3527911fa629c1a3e7823b89ce6f
Status: Downloaded newer image for tomcat:8.0
docker.io/library/tomcat:8.0
```

简单运行tomcat镜像

```
root@hp-None:~# docker run tomcat:8.0
21-Jul-2024 02:23:10.761 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version:        Apache Tomcat/8.0.53
21-Jul-2024 02:23:10.763 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Jun 29 2018 14:42:45 UTC
21-Jul-2024 02:23:10.764 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server number:         8.0.53.0
21-Jul-2024 02:23:10.764 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Linux
21-Jul-2024 02:23:10.765 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version:            6.5.0-44-generic
21-Jul-2024 02:23:10.765 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Architecture:          amd64
21-Jul-2024 02:23:10.765 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home:             /usr/lib/jvm/java-7-openjdk-amd64/jre
21-Jul-2024 02:23:10.766 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Version:           1.7.0_181-b01
21-Jul-2024 02:23:10.766 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Vendor:            Oracle Corporation
21-Jul-2024 02:23:10.767 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_BASE:         /usr/local/tomcat
21-Jul-2024 02:23:10.767 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_HOME:         /usr/local/tomcat
......
21-Jul-2024 02:23:12.340 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler ["http-apr-8080"]
21-Jul-2024 02:23:12.450 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler ["ajp-apr-8009"]
21-Jul-2024 02:23:12.456 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 1550 ms
```



http://192.168.6.136:8080/

访问不了tomcat

```
#查看防火墙状态
root@hp-None:~# ufw status

#关闭防火墙
root@hp-None:~# ufw disable
```

依旧访问不到。

这是由于容器是操作系统的隔离。



说明：直接运行容器这种方式，容器内无法直接访问。要想访问需建立容器与宿主机之间的映射

b.运行容器，同时设置容器与宿主机端口的映射关系

```
docker run -p 宿主机端口:容器端口 容器名称
```

运行tomcat容器，把tomcat8080端口映射到宿主机8080端口

```
root@hp-None:~# docker run -p 8080:8080 tomcat:8.0
21-Jul-2024 02:41:44.508 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version:        Apache Tomcat/8.0.53
21-Jul-2024 02:41:44.511 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Jun 29 2018 14:42:45 UTC
21-Jul-2024 02:41:44.511 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server number:         8.0.53.0
21-Jul-2024 02:41:44.512 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Name:               Linux
21-Jul-2024 02:41:44.512 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log OS Version:            6.5.0-44-generic
21-Jul-2024 02:41:44.512 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Architecture:          amd64
21-Jul-2024 02:41:44.513 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Java Home:             /usr/lib/jvm/java-7-openjdk-amd64/jre
21-Jul-2024 02:41:44.513 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Version:           1.7.0_181-b01
21-Jul-2024 02:41:44.513 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log JVM Vendor:            Oracle Corporation
21-Jul-2024 02:41:44.514 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_BASE:         /usr/local/tomcat
21-Jul-2024 02:41:44.515 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log CATALINA_HOME:         /usr/local/tomcat
```

http://192.168.6.136:8080/



运行tomcat容器，把tomcat8080端口映射到宿主机8081端口

```
root@hp-None:~# docker run -p 8081:8080 tomcat:8.0
21-Jul-2024 02:54:53.311 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version:        Apache Tomcat/8.0.53
21-Jul-2024 02:54:53.313 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Jun 29 2018 14:42:45 UTC
21-Jul-2024 02:54:53.313 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server number:         8.0.53.0
......
```

http://192.168.6.136:8081/



c.后台运行

运行tomcat，端口映射，后台启动该服务 **-d**

```
root@hp-None:~# docker run -p 8082:8080 -d tomcat:8.0
9dc6dfbfade9e2e5bb4471558720707e043451fed93ab670a3838b7a9a1c70db
```

http://192.168.6.136:8082/

d.指定容器名称

运行tomcat，端口映射，后台启动该服务，指定容器名称 --name 容器名称

```
root@hp-None:~# docker run -p 8083:8080 -d --name tomcat83 tomcat:8.0
......

#查看容器
root@hp-None:~# docker ps
CONTAINER ID   IMAGE        COMMAND             CREATED          STATUS          PORTS                                       NAMES
1399c47d6fbb   tomcat:8.0   "catalina.sh run"   3 minutes ago    Up 3 minutes    0.0.0.0:8083->8080/tcp, :::8083->8080/tcp   tomcat83
9dc6dfbfade9   tomcat:8.0   "catalina.sh run"   7 minutes ago    Up 7 minutes    0.0.0.0:8082->8080/tcp, :::8082->8080/tcp   stupefied_curran
0610383975cf   tomcat:8.0   "catalina.sh run"   12 minutes ago   Up 12 minutes   0.0.0.0:8081->8080/tcp, :::8081->8080/tcp   gifted_galileo
b8cc8cc2a275   tomcat:8.0   "catalina.sh run"   25 minutes ago   Up 25 minutes   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   nostalgic_cerf
994739d5f2f5   tomcat:8.0   "catalina.sh run"   44 minutes ago   Up 44 minutes   8080/tcp                                    magical_archimedes
```

http://192.168.6.136:8083/



3.停止容器

```
docker stop 容器名称|容器ID
```

停止容器tomcat83

```
root@hp-None:~# docker stop tomcat83
tomcat83

root@hp-None:~# docker ps
CONTAINER ID   IMAGE        COMMAND             CREATED          STATUS          PORTS                                       NAMES
9dc6dfbfade9   tomcat:8.0   "catalina.sh run"   17 minutes ago   Up 17 minutes   0.0.0.0:8082->8080/tcp, :::8082->8080/tcp   stupefied_curran
0610383975cf   tomcat:8.0   "catalina.sh run"   22 minutes ago   Up 22 minutes   0.0.0.0:8081->8080/tcp, :::8081->8080/tcp   gifted_galileo
b8cc8cc2a275   tomcat:8.0   "catalina.sh run"   35 minutes ago   Up 35 minutes   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   nostalgic_cerf
994739d5f2f5   tomcat:8.0   "catalina.sh run"   53 minutes ago   Up 53 minutes   8080/tcp                                    magical_archimedes
```

4.启动容器

```
docker start 容器名称|容器ID
```

启动容器tomcat83

```
root@hp-None:~# docker start tomcat83
tomcat83
```

重启tomcat83

```
root@hp-None:~# docker restart tomcat83
tomcat83
```

5.暂停/恢复容器

```
docker pause|unpause 容器名称|容器ID
```

示例：

```
#暂停tomcat83
root@hp-None:~# docker pause tomcat83
tomcat83

#恢复tomcat83
root@hp-None:~# docker unpause tomcat83
tomcat83
```



6.查看所有容器，包括运行、停止的容器

```
docker ps -a
```

示例：

```
root@hp-None:~# docker ps -a
CONTAINER ID   IMAGE          COMMAND             CREATED             STATUS                           PORTS                                       NAMES
1399c47d6fbb   tomcat:8.0     "catalina.sh run"   21 minutes ago      Exited (137) 13 seconds ago                                                  tomcat83
9dc6dfbfade9   tomcat:8.0     "catalina.sh run"   25 minutes ago      Up 25 minutes                    0.0.0.0:8082->8080/tcp, :::8082->8080/tcp   stupefied_curran
0610383975cf   tomcat:8.0     "catalina.sh run"   30 minutes ago      Up 30 minutes                    0.0.0.0:8081->8080/tcp, :::8081->8080/tcp   gifted_galileo
b8cc8cc2a275   tomcat:8.0     "catalina.sh run"   43 minutes ago      Up 43 minutes                    0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   nostalgic_cerf
994739d5f2f5   tomcat:8.0     "catalina.sh run"   About an hour ago   Up About an hour                 8080/tcp                                    magical_archimedes
```



7.查看容器日志

```
docker logs 容器名称|容器ID
```

查看tomcat83日志

```
root@hp-None:~# docker logs tomcat83
21-Jul-2024 03:04:19.888 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server version:        Apache Tomcat/8.0.53
21-Jul-2024 03:04:19.890 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server built:          Jun 29 2018 14:42:45 UTC
21-Jul-2024 03:04:19.890 INFO [main] org.apache.catalina.startup.VersionLoggerListener.log Server number:         8.0.53.0
......
```

实时监控容器内服务的日志：**docker logs -f 容器名称|容器ID**

查看1399c47d6fbb容器的实时日志（可重启容器进行对比）

```
root@hp-None:~# docker logs -f 1399c47d6fbb
......
```



8.删除容器

```
#删除已停止的容器
docker rm 容器名称|容器ID 

#强制删除容器（即使运行的容器也能删除）
docker rm -f 容器名称|容器ID 

#删除所有容器
docker rm -f $(docker ps -qa)
```

删除正在运行的容器

```
root@hp-None:~# docker rm tomcat83
Error response from daemon: You cannot remove a running container 1399c47d6fbbc42d89fdccad83e962aa5c03a0640e48df47ec49ce81d03da456. Stop the container before attempting removal or force remove
```

强制删除

```
root@hp-None:~# docker rm -f tomcat83
tomcat83

#查看正在运行的容器
root@hp-None:~# docker ps
CONTAINER ID   IMAGE        COMMAND             CREATED       STATUS       PORTS                                       NAMES
9dc6dfbfade9   tomcat:8.0   "catalina.sh run"   2 hours ago   Up 2 hours   0.0.0.0:8082->8080/tcp, :::8082->8080/tcp   stupefied_curran
0610383975cf   tomcat:8.0   "catalina.sh run"   2 hours ago   Up 2 hours   0.0.0.0:8081->8080/tcp, :::8081->8080/tcp   gifted_galileo
b8cc8cc2a275   tomcat:8.0   "catalina.sh run"   2 hours ago   Up 2 hours   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   nostalgic_cerf
994739d5f2f5   tomcat:8.0   "catalina.sh run"   2 hours ago   Up 2 hours   8080/tcp                                    magical_archimedes
```

删除所有容器

```
root@hp-None:~# docker rm -f $(docker ps -qa)
9dc6dfbfade9
0610383975cf
b8cc8cc2a275
994739d5f2f5
da8dc2930d7f
65581914eb04

root@hp-None:~# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
root@hp-None:~# docker ps -a
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```



**9.进入容器内部（重点）**

```
docker exec -it 容器名称|容器ID bash
```

-it:交互模式

bash:与容器中的bash进行交互

示例：

```
root@hp-None:~# docker pull tomcat:8.0
8.0: Pulling from library/tomcat
f189db1b88b3: Pull complete 
3d06cf2f1b5e: Pull complete 
edd0da9e3091: Pull complete 
eb7768aae14e: Pull complete 
e2780f585e0f: Pull complete 
e5ed720afeba: Pull complete 
d9e134700cfc: Pull complete 
e4804b33d02a: Pull complete 
b9df0c24315e: Pull complete 
49fdae8eaa20: Pull complete 
1aea3d9a32e6: Pull complete 
Digest: sha256:8ecb10948deb32c34aeadf7bf95d12a93fbd3527911fa629c1a3e7823b89ce6f
Status: Downloaded newer image for tomcat:8.0
docker.io/library/tomcat:8.0

#运行容器
root@hp-None:~# docker run -p 8081:8080 --name tomcat1 tomcat:8.0
......

#查看容器
root@hp-None:~# docker ps
CONTAINER ID   IMAGE        COMMAND             CREATED              STATUS              PORTS                                       NAMES
fae9d1e90ebe   tomcat:8.0   "catalina.sh run"   About a minute ago   Up About a minute   0.0.0.0:8081->8080/tcp, :::8081->8080/tcp   tomcat1

#进入容器内部
root@hp-None:~# docker exec -it tomcat1 bash
root@fae9d1e90ebe:/usr/local/tomcat# ls
LICENSE  NOTICE  RELEASE-NOTES  RUNNING.txt  bin  conf  include  lib  logs  native-jni-lib  temp  webapps  work
root@fae9d1e90ebe:/usr/local/tomcat# cd webapps/
root@fae9d1e90ebe:/usr/local/tomcat/webapps# ls
ROOT  docs  examples  host-manager  manager
root@fae9d1e90ebe:/usr/local/tomcat/webapps# cd ROOT/
root@fae9d1e90ebe:/usr/local/tomcat/webapps/ROOT# ls
RELEASE-NOTES.txt  asf-logo-wide.svg  bg-middle.png    bg-nav.png    favicon.ico  tomcat-power.gif  tomcat.gif  tomcat.svg
WEB-INF            bg-button.png      bg-nav-item.png  bg-upper.png  index.jsp    tomcat.css        tomcat.png
root@fae9d1e90ebe:/usr/local/tomcat/webapps/ROOT# echo 'Hello Docker' > index.jsp
```



http://192.168.6.136:8081/



退出容器

```
root@fae9d1e90ebe:/usr/local/tomcat/webapps/ROOT# exit
exit
root@hp-None:~# 
```

[思考：修改了容器的内容，镜像的内容会不会跟着修改]



10.容器与宿主机之间文件拷贝

```
docker cp 容器名称|容器ID 容器文件或目录 宿主机指定目录
```

把tomcat1容器/usr/local/tomcat/RUNNING.txt拷贝到宿主机的root目录下

```
root@hp-None:~# docker cp tomcat1:/usr/local/tomcat/RUNNING.txt /root
Successfully copied 17.9kB to /root
root@hp-None:~# ls
RUNNING.txt  snap
root@hp-None:~# cat RUNNING.txt
......
```

把宿主机root/abc.txt拷贝到tomcat1容器/usr/local/tomcat/下

```
root@hp-None:~# docker cp abc.txt  tomcat1:/usr/local/tomcat/
Successfully copied 2.05kB to tomcat1:/usr/local/tomcat/
```

【如何部署web项目（war项目）】

1）使用filezilla.exe上传hp目录到root目录下

2）拷贝hp目录到tomcat1:/usr/local/tomcat/webapps/ROOT下

```
root@hp-None:~# docker cp hp tomcat1:/usr/local/tomcat/webapps/ROOT
Successfully copied 8.92MB to tomcat1:/usr/local/tomcat/webapps/ROOT
```

3）运行测试

http://192.168.6.136:8081/hp/json/HOME_URL.json





## 2.操作Tomcat实例

在Ubuntu系统中，使用Docker完成以下操作：

1. **部署Tomcat容器**：拉取官方Tomcat镜像，将容器的`8080`端口映射到宿主机的`9009`端口，以守护进程（后台）模式启动，并指定容器名称为`tomcat1`；
2. **访问Tomcat服务**：通过浏览器访问宿主机的`9009`端口，验证Tomcat默认页面是否加载成功；
3. 管理容器生命周期：
   - 停止`tomcat1`容器；
   - 查看所有容器（包括运行中和已停止的）；
   - 查看`tomcat1`容器的日志；
   - 进入tomcat1容器内部，修改页面显示内容为“Hello Tomcat!”；
   - 强制删除`tomcat1`容器；
   - 清理其他残留的Tomcat容器（如有）。

实施步骤如下所示。

（1）拉取tomcat8.0

```
root@hp-None:~# docker pull tomcat:8.0
8.0: Pulling from library/tomcat
……
Digest: sha256:8ecb10948deb32c34aeadf7bf95d12a93fbd3527911fa629c1a3e7823b89ce6f
Status: Downloaded newer image for tomcat:8.0
docker.io/library/tomcat:8.0

# 查看tomcat镜像

root@hp-None:~# docker images|grep tomcat
tomcat        9.0       7e1d2500bd13   3 weeks ago     469MB
tomcat        8.5       0a2249be3d31   16 months ago   456MB
tomcat        8.0       ef6a7c98d192   6 years ago     356MB
```



（2）将容器的`8080`端口映射到宿主机的`9009`端口，以守护进程（后台）模式启动，并指定容器名称为`tomcat1`；

```
root@hp-None:~# root@hp-docker:~# docker run -p 9009:8080 -d --name tomcat1 tomcat:8.0
a29057dc2b0b5a89db513f077b16726404a3cae80206d6c038d6b3317d29fc41
```

使用浏览器访问：

http://192.168.6.136:9009/



（3）停止tomcat1

```
root@hp-None:~# docker stop tomcat1
tomcat1
```

刷新浏览器。

（4）查看所有容器（包括运行中和已停止的）；

```
root@hp-None:~# docker ps -a
```

（5）查看`tomcat1`容器的日志；

```
root@hp-None:~# docker logs tomcat1
```



（6）进入tomcat1容器内部，修改页面显示内容为“Hello Tomcat!”；

```
# 重启tomcat1
root@hp-None:~# docker restart tomcat1
tomcat1

# 进入tomcat1
root@hp-docker:~# docker exec -it tomcat1 bash
root@a29057dc2b0b:/usr/local/tomcat# ls
LICENSE  NOTICE  RELEASE-NOTES  RUNNING.txt  bin  conf  include  lib  logs  native-jni-lib  temp  webapps  work
root@a29057dc2b0b:/usr/local/tomcat# cd webapps/
root@a29057dc2b0b:/usr/local/tomcat/webapps# ls
ROOT  docs  examples  host-manager  manager
root@a29057dc2b0b:/usr/local/tomcat/webapps# cd ROOT/
root@a29057dc2b0b:/usr/local/tomcat/webapps/ROOT# ls
RELEASE-NOTES.txt  asf-logo-wide.svg  bg-middle.png    bg-nav.png    favicon.ico  tomcat-power.gif  tomcat.gif  tomcat.svg
WEB-INF            bg-button.png      bg-nav-item.png  bg-upper.png  index.jsp    tomcat.css        tomcat.png

# 修改内容
root@a29057dc2b0b:/usr/local/tomcat/webapps/ROOT# echo 'Hello Tomcat' > index.jsp

```

刷新浏览器。

（7）强制删除`tomcat1`容器；

```
root@hp-None:~# service docker restart

docker rm -f $(docker ps -qa)

# 退出容器
root@a29057dc2b0b:/usr/local/tomcat/webapps/ROOT# exit
exit

# 强制删除tomcat1
root@hp-None:~# docker rm -f tomcat1
tomcat1
```



## 3.运行MySQL服务

本任务以操作MySQL8.0为例来巩固容器操作命令，实施步骤如下所示。

（1）拉取mysql8.0

```
root@hp-None:~# docker pull mysql:8.0
8.0: Pulling from library/mysql
72a69066d2fe: Pull complete 
93619dbc5b36: Pull complete 
99da31dd6142: Pull complete 
626033c43d70: Pull complete 
37d5d7efb64e: Pull complete 
ac563158d721: Pull complete 
d2ba16033dad: Pull complete 
688ba7d5c01a: Pull complete 
00e060b6d11d: Pull complete 
1c04857f594f: Pull complete 
4d7cfa90e6ea: Pull complete 
e0431212d27d: Pull complete 
Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709
Status: Downloaded newer image for mysql:8.0
docker.io/library/mysql:8.0
```

（2）运行mysql

启动mysql，开放端口映射3306，指定root用户密码 -e（environment：环境），后台运行，指定名称

```
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Hp.123456 -d --name mysql8 mysql:8.0
```

示例：

```
root@hp-None:~# docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Hp.123456 -d --name mysql8 mysql:8.0
6c616bedd441de3137b119471fdc566867732d3bd6cce628cf760bd6ea8617d5

root@hp-None:~# docker ps
CONTAINER ID   IMAGE        COMMAND                   CREATED          STATUS          PORTS                                                  NAMES
6c616bedd441   mysql:8.0    "docker-entrypoint.s…"   35 seconds ago   Up 34 seconds   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   mysql8
fae9d1e90ebe   tomcat:8.0   "catalina.sh run"         5 hours ago      Up 5 hours      0.0.0.0:8081->8080/tcp, :::8081->8080/tcp              tomcat1

#查看日志，看是否启动完成
root@hp-None:~# docker logs 6c616bedd441
2024-07-21 12:41:35+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.27-1debian10 started.
2024-07-21 12:41:35+00:00 [Note] [Entrypoint]: Switching to dedicated user 'mysql'
2024-07-21 12:41:35+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.27-1debian10 started.
2024-07-21 12:41:35+00:00 [Note] [Entrypoint]: Initializing database files
```

（3）使用Navicat连接

（4）重启容器

```
root@hp-None:~# systemctl restart docker
root@docker:~# docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```

启动容器后，发现mysql服务停止了。我们希望重启容器后，mysql服务自动启动。

（5）设置总是运行

启动mysql，开放端口映射3306，指定root用户密码 -e（environment：环境），后台运行，指定名称，总是运行--restart=always

```
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Hp.123456 -d --name mysql8-01 --restart=always mysql:8.0
```



```
root@hp-None:~# docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Hp.123456 -d --name mysql8-01 --restart=always mysql:8.0
fefc89a580dcf53ae0652f514b27be4fc36d0f7f6cff4796d97187a19b6105b7
```

再启动容器，发现mysql在运行。

（6）使用数据卷持久化数据到宿主机

启动mysql，开放端口映射3306，指定root用户密码 -e（environment：环境），后台运行，指定名称，总是运行--restart=always，**数据卷持久化数据到宿主机**

```
docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Hp.123456 -d --name mysql8-02 --restart=always -v /root/data:/var/lib/mysql mysql:8.0
```

-v：数据卷挂载

/root/data：宿主机目录，可以不存在，会自动创建

/var/lib/mysql：容器指定目录。



先删除所有容器

```
root@hp-None:~# docker rm -f $(docker ps -qa)
722e56814f3d
6c616bedd441
8ae76aacec5a
fae9d1e90ebe
```



```
root@hp-None:~# docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=Hp.123456 -d --name mysql8-02 --restart=always -v /root/data:/var/lib/mysql mysql:8.0
67bd852b6d61a673fe163946ff51b8f1dad10099d6fe70e253a3414654e5eb2b
```

查看data目录

```
root@hp-None:~# ls
abc.txt  data  hp  RUNNING.txt  snap
root@hp-None:~# cd data/
root@hp-None:~/data# ls
 auto.cnf        binlog.index   client-cert.pem     '#ib_16384_1.dblwr'   ib_logfile0  '#innodb_temp'   performance_schema   server-cert.pem   undo_001
 binlog.000001   ca-key.pem     client-key.pem       ib_buffer_pool       ib_logfile1   mysql           private_key.pem      server-key.pem    undo_002
 binlog.000002   ca.pem        '#ib_16384_0.dblwr'   ibdata1              ibtmp1        mysql.ibd       public_key.pem       sys
root@hp-None:~/data# 
```

使用Navicat创建数据库，比如test数据库，查看data目录，可以看到创建的test数据库。

```
root@hp-None:~/data# ls
 auto.cnf        binlog.index   client-cert.pem     '#ib_16384_1.dblwr'   ib_logfile0  '#innodb_temp'   performance_schema   server-cert.pem   test
 binlog.000001   ca-key.pem     client-key.pem       ib_buffer_pool       ib_logfile1   mysql           private_key.pem      server-key.pem    undo_001
 binlog.000002   ca.pem        '#ib_16384_0.dblwr'   ibdata1              ibtmp1        mysql.ibd       public_key.pem       sys               undo_002
root@hp-None:~/data# 
```

【思考题：现在删除数据库容器，数据库里的数据怎么恢复？】



## 4.运行Nginx服务

本任务以操作nginx为例来巩固容器操作命令，实施步骤如下所示。

（1）拉取nginx

```
#拉取nginx
root@hp-None:~# docker pull nginx:1.19.10
1.19.10: Pulling from library/nginx
69692152171a: Pull complete 
49f7d34d62c1: Pull complete 
5f97dc5d71ab: Pull complete 
cfcd0711b93a: Pull complete 
be6172d7651b: Pull complete 
de9813870342: Pull complete 
Digest: sha256:df13abe416e37eb3db4722840dd479b00ba193ac6606e7902331dcea50f4f1f2
Status: Downloaded newer image for nginx:1.19.10
docker.io/library/nginx:1.19.10
#查看镜像
root@hp-None:~# docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
redis        latest    7614ae9453d1   2 years ago   113MB
mysql        8.0       3218b38490ce   2 years ago   516MB
nginx        1.19.10   f0b8a9a54136   3 years ago   133MB
redis        6.0.9     6060df96cef3   3 years ago   104MB
tomcat       8.0       ef6a7c98d192   5 years ago   356MB
```



（2）启动nginx

启动nginx，映射端口，后台启动，指定名称，总是启动

docker run -p 80:80 -d  --name nginx01 --restart=always nginx:1.19.10

```
root@hp-None:~# docker run -p 80:80 -d  --name nginx01 --restart=always nginx:1.19.10
69e7dd30193983a7d631423ed4dec2b2e0231a4601b97add2d556d2f1d0bf5d3
```

浏览器访问：http://192.168.6.136/



修改页面内容

```
#进入容器，查找index.html
root@hp-None:~# docker exec -it 69e bash
root@69e7dd301939:/# find / -name index.html
find: '/proc/31/task/31/fdinfo': Permission denied
find: '/proc/31/map_files': Permission denied
find: '/proc/31/fdinfo': Permission denied
/usr/share/nginx/html/index.html

root@69e7dd301939:/# cd /usr/share/nginx/html/
root@69e7dd301939:/usr/share/nginx/html# ls
50x.html  index.html
root@69e7dd301939:/usr/share/nginx/html# echo "Hello Nginx" > index.html
```

刷新浏览器

http://192.168.6.136/



（3）启动nginx，加载配置文件（nginx更多地作为负载均衡和反向代理）

启动nginx，映射端口，后台启动，指定名称，总是启动，加载nginx配置文件 -v 容器(/etc/nginx/nginx.conf)

docker run -p 80:80 -d  --name nginx01 --restart=always -v /root/nginxconfig/nginx.conf:/etc/nginx/nginx.conf nginx:1.19.10

查找nginx.conf

```
root@69e7dd301939:/# find / -name nginx.conf
find: '/proc/31/task/31/fdinfo': Permission denied
find: '/proc/31/map_files': Permission denied
find: '/proc/31/fdinfo': Permission denied
/etc/nginx/nginx.conf
```



拷贝容器/etc/nginx/nginx.conf到宿主机的/root/nginxconfig/

```
root@hp-None:~# mkdir nginxconfig
root@hp-None:~# docker cp 69e7dd301939:/etc/nginx/nginx.conf /root/nginxconfig/
Successfully copied 2.56kB to /root/nginxconfig/
root@hp-None:~/nginxconfig# ls
nginx.conf
```



运行容器

```
root@hp-None:~# docker ps
CONTAINER ID   IMAGE           COMMAND                   CREATED             STATUS             PORTS                                                  NAMES
69e7dd301939   nginx:1.19.10   "/docker-entrypoint.…"   About an hour ago   Up About an hour   0.0.0.0:80->80/tcp, :::80->80/tcp                      nginx01
834a021d5e54   redis:6.0.9     "docker-entrypoint.s…"   3 hours ago         Up 3 hours         0.0.0.0:6379->6379/tcp, :::6379->6379/tcp              redis03
02e6eb10762f   mysql:8.0       "docker-entrypoint.s…"   36 hours ago        Up 36 hours        0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   mysql8-02
#删除前面的nginx容器
root@hp-None:~# docker rm -f 69e7dd301939
69e7dd301939
#运行nginx容器
root@hp-None:~# docker run -p 80:80 -d  --name nginx01 --restart=always -v /root/nginxconfig/nginx.conf:/etc/nginx/nginx.conf nginx:1.19.10
cc2fef6311e91097309c2d1f1691ea580137d487d0c04201831eb74d1d69b562
```

浏览器查看。

修改nginx.conf配置文件

```
root@docker:~# cd nginxconfig/
root@docker:~/nginxconfig# ls
nginx.conf
root@docker:~/nginxconfig# nano nginx.conf 
```



```
#运行nginx容器
root@hp-None:~# docker run -p 8099:8088 -d  --name nginx02 --restart=always -v /root/nginxconfig/nginx.conf:/etc/nginx/nginx.conf nginx:1.19.10
d53a155b1dd150f6020ede7bcd89140a2d06b11fcdc1a614a41f64f03959b1b8
```

浏览器访问：http://192.168.6.136:8099/


